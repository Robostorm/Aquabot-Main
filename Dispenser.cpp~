#include "Dispenser.h"

static int Dispenser::update(unsigned long now){
  static int state = DISPREADY;
  
  switch(state){
  case DISPREADY:
    if(irState == LOW){
      state = GETTING;
    }
    servoState = 0;
    servoWait = 0;
    return 1;
  case DISPGETTING:
    billPower = 255;
    if(photoState == HIGH) {
      state = DISPENSING;
    }
    actionText = "Bill Detected";
    return 1;
  case DISPDISPENSING:
    if(photoState == HIGH){
      actionText = "Waiting for Bill";
      return 1;
    }else{
      billPower = 0;
      dispense(now);
    }
    return 1;
        
  case DISPDONE:
    state = READY;
    return 1;
  }
}
